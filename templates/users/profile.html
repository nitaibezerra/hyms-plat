{% extends "base.html" %}

{% block title %}{{ profile_user.get_full_name|default:profile_user.username }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 0 auto;">
    <div style="display: flex; align-items: flex-start; gap: 30px; margin-bottom: 30px;">
        {% if profile_user.avatar %}
        <img src="{{ profile_user.avatar.url }}"
             alt="{{ profile_user.get_full_name|default:profile_user.username }}"
             style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #2c5282;">
        {% else %}
        <div style="width: 120px; height: 120px; border-radius: 50%; background: #2c5282; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; font-weight: 700;">
            {{ profile_user.get_full_name.0|default:profile_user.username.0|upper }}
        </div>
        {% endif %}

        <div style="flex: 1;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <h1 style="color: #2c5282; margin-bottom: 5px;">
                        {{ profile_user.get_full_name|default:profile_user.username }}
                    </h1>
                    {% if profile_user.get_full_name %}
                    <p style="color: #666; margin-bottom: 10px;">@{{ profile_user.username }}</p>
                    {% endif %}
                </div>

                <div style="display: flex; gap: 8px;">
                    {% if is_own_profile %}
                    <a href="{% url 'users:profile_edit' profile_user.username %}"
                       class="btn btn-secondary"
                       style="font-size: 14px; padding: 8px 16px;">
                        Editar Perfil
                    </a>
                    {% elif user.is_authenticated %}
                    <button
                        data-action="toggle-follow"
                        data-username="{{ profile_user.username }}"
                        class="btn {% if is_following %}following{% endif %}"
                        style="font-size: 14px; padding: 8px 16px; {% if is_following %}background: #48bb78;{% endif %}">
                        {% if is_following %}✓ Seguindo{% else %}Seguir{% endif %}
                    </button>
                    {% endif %}
                </div>
            </div>

            {% if profile_user.bio %}
            <p style="color: #333; margin-top: 15px; line-height: 1.6;">{{ profile_user.bio }}</p>
            {% endif %}

            <div style="display: flex; gap: 20px; margin-top: 15px; color: #666; font-size: 14px;">
                <div>
                    <strong style="color: #2c5282;">{{ hymnbooks.count }}</strong> hinário{{ hymnbooks.count|pluralize }}
                </div>
                <div>
                    <a href="{% url 'users:followers_list' username=profile_user.username %}" style="color: #666; text-decoration: none;">
                        <strong style="color: #2c5282;">{{ followers_count }}</strong> seguidor{{ followers_count|pluralize:"es" }}
                    </a>
                </div>
                <div>
                    <a href="{% url 'users:following_list' username=profile_user.username %}" style="color: #666; text-decoration: none;">
                        <strong style="color: #2c5282;">{{ following_count }}</strong> seguindo
                    </a>
                </div>
                <div>
                    Membro desde {{ profile_user.date_joined|date:"F \d\e Y" }}
                </div>
            </div>
        </div>
    </div>

    {% if hymnbooks %}
    <div style="border-top: 1px solid #eee; padding-top: 30px;">
        <h2 style="color: #2c5282; margin-bottom: 20px; font-size: 22px;">
            Hinários Contribuídos
        </h2>

        <div class="grid" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
            {% for hymnbook in hymnbooks %}
            <div class="card" style="padding: 15px; transition: transform 0.2s; cursor: pointer;"
                 onclick="window.location='{% url 'hymns:hymnbook_detail' hymnbook.slug %}'">
                {% if hymnbook.cover_image %}
                <img src="{{ hymnbook.cover_image.url }}"
                     alt="{{ hymnbook.name }}"
                     style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px; margin-bottom: 10px;">
                {% else %}
                <div style="width: 100%; height: 150px; background: linear-gradient(135deg, #2c5282 0%, #4299e1 100%); border-radius: 4px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 18px; text-align: center; padding: 10px;">
                    {{ hymnbook.intro_name|default:hymnbook.name }}
                </div>
                {% endif %}

                <h3 style="margin: 0 0 5px 0; font-size: 16px; color: #2c5282;">
                    {{ hymnbook.name }}
                </h3>
                <p style="color: #666; font-size: 14px; margin: 0;">
                    {{ hymnbook.hymn_count }} hino{{ hymnbook.hymn_count|pluralize }}
                </p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div style="border-top: 1px solid #eee; padding-top: 30px; text-align: center; color: #666;">
        <p style="font-size: 18px; margin-bottom: 10px;">
            {% if is_own_profile %}
                Você ainda não contribuiu com nenhum hinário.
            {% else %}
                Este usuário ainda não contribuiu com nenhum hinário.
            {% endif %}
        </p>
        {% if is_own_profile %}
        <a href="{% url 'users:upload' %}" class="btn" style="margin-top: 15px;">
            Contribuir com Hinário
        </a>
        {% endif %}
    </div>
    {% endif %}

    {% comment %} Favorites Section {% endcomment %}
    {% if is_own_profile and favorites %}
    <div style="border-top: 1px solid #eee; padding-top: 30px; margin-top: 30px;">
        <h2 style="color: #2c5282; margin-bottom: 20px; font-size: 22px;">
            Hinos Favoritos
        </h2>

        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for favorite in favorites %}
            <a href="{% url 'hymns:hymn_detail' pk=favorite.hymn.id %}"
               class="card"
               style="text-decoration: none; padding: 15px; border-left: 4px solid #e53e3e; transition: transform 0.2s; display: block;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin: 0 0 5px 0; font-size: 16px; color: #2c5282;">
                            {{ favorite.hymn.number }}. {{ favorite.hymn.title }}
                        </h3>
                        <p style="color: #666; font-size: 14px; margin: 0;">
                            {{ favorite.hymn.hymn_book.name }} — {{ favorite.hymn.hymn_book.owner_name }}
                        </p>
                    </div>
                    <span style="font-size: 24px;">❤️</span>
                </div>
            </a>
            {% endfor %}
        </div>

        {% if favorites|length >= 10 %}
        <p style="text-align: center; color: #718096; font-size: 14px; margin-top: 15px;">
            Mostrando os 10 hinos favoritos mais recentes
        </p>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
